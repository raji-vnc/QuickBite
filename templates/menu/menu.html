<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ restaurant.name }} - Menu</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50">

    <!-- RESTAURANT HEADER -->
    <div class="bg-white shadow">
        <div class="max-w-5xl mx-auto p-6 flex items-center gap-6">
            <img src="{{ restaurant.logo.url }}" class="w-24 h-24 rounded-xl object-cover">

            <div>
                <h1 class="text-3xl font-bold">{{ restaurant.name }}</h1>
                <p class="text-gray-600">{{ restaurant.address }}</p>

                <div class="mt-2 flex items-center gap-3">
                    <span class="bg-green-500 text-white px-2 py-1 text-sm rounded">★ 4.6</span>
                    <span class="text-gray-500">30–40 mins</span>
                </div>
            </div>
        </div>
    </div>

    <!-- CATEGORY TABS -->
    <div class="max-w-5xl mx-auto mt-6">
        <div class="flex gap-4 overflow-x-auto pb-3">
            <a href="?category=all">
               All
            </a>

            {% for category in categories %}
            <a href="?category={{ category.id }}">
               {{ category.name }}
            </a>
            {% endfor %}
        </div>
    </div>
<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
    {% for item in items %}
    <div class="bg-white rounded-xl shadow overflow-hidden">
        <img src="{{ item.image.url }}" class="w-full h-40 object-cover">
        
        <div class="p-4">
            <h4 class="text-lg font-bold">{{ item.name }}</h4>
            <p class="text-sm text-gray-500">{{ item.description|truncatewords:10 }}</p>

            <p class="mt-2 font-bold">₹{{ item.price }}</p>

            <button class="ajax-add-to-cart w-full mt-3 bg-red-500 text-white py-2 rounded-xl"
                    data-item-id="{{ item.id }}">
                Add to Cart
            </button>
        </div>
    </div>
    {% endfor %}
</div>

    <!-- MENU ITEMS -->
    <div class="max-w-5xl mx-auto mt-8 grid grid-cols-2 gap-6">

        {% for item in items %}
        <div class="bg-white p-4 rounded-xl shadow hover:shadow-lg transition">
            
            <img src="{{ item.image.url }}" class="w-full h-48 rounded-lg object-cover">

            <h2 class="text-xl font-bold mt-3">{{ item.name }}</h2>
            <p class="text-gray-600 text-sm">{{ item.description }}</p>

            <div class="mt-2 flex items-center justify-between">
                <span class="text-lg font-semibold">₹{{ item.price }}</span>

                <form method="POST" action="{% url 'add_to_cart' item.id %}">
                    {% csrf_token %}
                    <button type="submit" class="px-4 py-2 bg-red-500 text-white rounded-xl hover:bg-red-600">
                        Add to Cart
                    </button>
                </form>
            </div>

        </div>
        {% endfor %}

    </div>

    <!-- REVIEW BUTTON -->
<button onclick="document.getElementById('reviewModal{{ item.id }}').showModal()"
        class="mt-2 bg-gray-800 text-white px-4 py-2 rounded-xl">
    Add Review
</button>

<!-- REVIEW MODAL -->
<dialog id="reviewModal{{ item.id }}" class="p-6 rounded-xl shadow-xl border w-96">

    <form method="POST" action="/review/add/{{ item.id }}/">
        {% csrf_token %}

        <h2 class="text-xl font-bold mb-3">Rate {{ item.name }}</h2>

        <label class="font-semibold">Rating</label>
        <select name="rating" class="w-full border p-2 rounded-xl mb-3">
            <option value="5">5 ⭐</option>
            <option value="4">4 ⭐</option>
            <option value="3">3 ⭐</option>
            <option value="2">2 ⭐</option>
            <option value="1">1 ⭐</option>
        </select>

        <textarea name="comment" class="w-full border p-2 rounded-xl mb-3"
                  rows="3" placeholder="Write your review..."></textarea>

        <button class="w-full bg-red-500 text-white py-2 rounded-xl">Submit</button>
    </form>

    <button onclick="document.getElementById('reviewModal{{ item.id }}').close()"
            class="w-full mt-2 border border-gray-400 py-2 rounded-xl">
        Cancel
    </button>

</dialog>

<div class="mt-4 bg-gray-50 p-3 rounded-xl">

    <h3 class="font-bold mb-2">Reviews</h3>

    {% for review in item.review_set.all %}
        <div class="border-b py-2">
            <p class="font-semibold">{{ review.user.username }} — {{ review.rating }} ⭐</p>
            <p class="text-gray-600 text-sm">{{ review.comment }}</p>
            <p class="text-gray-400 text-xs">{{ review.created_at }}</p>
        </div>
    {% empty %}
        <p class="text-gray-500 text-sm">No reviews yet.</p>
    {% endfor %}
</div>

</body>
</html>
